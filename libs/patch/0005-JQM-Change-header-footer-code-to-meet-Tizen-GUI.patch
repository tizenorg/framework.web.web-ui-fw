From 372d8508f064dc0a28b44707baf4c0832e75e2ad Mon Sep 17 00:00:00 2001
From: Minkyu Kang <mk7.kang@samsung.com>
Date: Thu, 16 Feb 2012 18:00:47 +0900
Subject: [PATCH 1/2] JQM: Change header/footer code to meet Tizen GUI

---
 .../js/jquery.mobile.fixHeaderFooter.js            |  364 ++++++++++++++++----
 1 files changed, 299 insertions(+), 65 deletions(-)

diff --git a/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js b/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
index 3bb5613..2aa10b5 100644
--- a/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
+++ b/libs/js/jquery-mobile-1.0.1pre/js/jquery.mobile.fixHeaderFooter.js
@@ -1,5 +1,46 @@
-/*
-* "fixHeaderFooter" plugin - on-demand positioning for headers,footers
+/**
+* Header/Footer can be created using the 
+* data-role="header", data-role="footer" attribute to an element.
+*
+* Every page in SLP theme have Header&Footer and default footer contains back button
+* Framework automatically generate footer even though web developer does not define footer
+* For more detail footer usage, refer Page(page.section.js) guideline
+*
+* Attribute:
+*    data-position : default value is fixed, automatically generated footer has fixed position, 
+                   in header, web dev. defines header fix or not.
+* 
+* Examples:
+*         
+*     HTML markup for creating header : 
+*         <div data-role="header" data-position="fixed">
+*             <h1>NBeat UI</h1>
+*         </div>
+*
+*     HTML markup for creating 1 button title ( button is available 1~3 )
+*         <div data-role="header" data-position="fixed">
+*             <a>Text1</a>
+*             <h1>Title Area</h1>			
+*         </div>
+*
+*     HTML markup for creating 2 button and groupControl title ( Groupcontrol is available 2~4 )
+*     <div data-role="header" data-position="fixed">
+*         <a>Text</a>	
+*         <h1>Title Extend 2 Button </h1>
+*         <a>Text</a>		
+*         <div data-role="fieldcontain">
+*             <fieldset data-role="controlgroup" data-type="horizontal">
+*                 <input type="radio" name="radio-view-8" data-icon="segment-titlestyle-segonly" id="segment1" value="on" checked="checked" />
+*                 <label for="segment1">All</label>
+*                 <input type="radio" name="radio-view-8" data-icon="segment-titlestyle-segonly" id="segment2" value="off" />
+*                 <label for="segment2">Call</label>
+*             </fieldset>
+*         </div>			
+*     </div>
+*
+*     HTML markup for creating footer
+*         <div data-role="footer" data-position="fixed">
+*         </div>
 */
 
 (function( $, undefined ) {
@@ -50,7 +91,8 @@ $.mobile.fixedToolbars = (function() {
 		touchStopEvent = supportTouch ? "touchend" : "mouseup",
 		stateBefore = null,
 		scrollTriggered = false,
-		touchToggleEnabled = true;
+		touchToggleEnabled = true,
+		defaultFooterHeight = 114;
 
 	function showEventCallback( event ) {
 		// An event that affects the dimensions of the visual viewport has
@@ -62,12 +104,36 @@ $.mobile.fixedToolbars = (function() {
 		//
 		// If we are in autoHideMode, we don't do anything because we know the scroll
 		// callbacks for the plugin will fire off a show when the scrolling has stopped.
+
+
+		/* resize test : Jinhyuk    */
+		var footer_filter;
+		if( $( document ).find( ".ui-page-active" ).length ) 
+			footer_filter = $( document ).find( ".ui-page-active" ).find( ":jqmData(role='footer')" );		
+		else 
+			footer_filter = $( document ).find( ":jqmData(role='footer')" ).eq( 0 ); 	
+
+		var footerNavbar = footer_filter.find(".ui-navbar");
+
+		if(footer_filter.height()< defaultFooterHeight)
+			footer_filter.css("height", defaultFooterHeight);
+		footer_filter
+			.css("top",window.innerHeight  - footer_filter.height())
+			.show();	
+		if(footerNavbar.jqmData("style") == "toolbar"){
+			footerNavbar
+				.css("width", window.innerWidth - footerNavbar.siblings(".ui-btn").width());		
+		}					
+		/* resize test : Jinhyuk    */
+
 		if ( !autoHideMode && currentstate === "overlay" ) {
 			if ( !delayTimer ) {
-				$.mobile.fixedToolbars.hide( true );
+				/* Fixed header modify for theme-s : Jinhyuk */
+				if(!($( event.target).find( ":jqmData(role='header')" ).is(":jqmData(position='fixed')")&&
+				$( event.target).find( ":jqmData(role='header')" ).is(".ui-bar-s")))				
+					$.mobile.fixedToolbars.hide( true );
 			}
-
-			$.mobile.fixedToolbars.startShowTimer();
+			$.mobile.fixedToolbars.startShowTimer(); 
 		}
 	}
 
@@ -107,31 +173,34 @@ $.mobile.fixedToolbars = (function() {
 
 		( ( $document.scrollTop() === 0 ) ? $window : $document )
 			.bind( "scrollstart", function( event ) {
-
-				scrollTriggered = true;
-
-				if ( stateBefore === null ) {
-					stateBefore = currentstate;
-				}
-
-				// We only enter autoHideMode if the headers/footers are in
-				// an overlay state or the show timer was started. If the
-				// show timer is set, clear it so the headers/footers don't
-				// show up until after we're done scrolling.
-				var isOverlayState = stateBefore == "overlay";
-
-				autoHideMode = isOverlayState || !!delayTimer;
-
-				if ( autoHideMode ) {
-					$.mobile.fixedToolbars.clearShowTimer();
-
-					if ( isOverlayState ) {
-						$.mobile.fixedToolbars.hide( true );
+				/* Fixed header modify for theme-s : Jinhyuk */
+				if(!$( event.target).find( ":jqmData(role='header')" ).is(":jqmData(position='fixed')"))
+				{
+					scrollTriggered = true;
+	
+					if ( stateBefore === null ) {
+						stateBefore = currentstate;
 					}
+	
+					// We only enter autoHideMode if the headers/footers are in
+					// an overlay state or the show timer was started. If the
+					// show timer is set, clear it so the headers/footers don't
+					// show up until after we're done scrolling.
+					var isOverlayState = stateBefore == "overlay";
+	
+					autoHideMode = isOverlayState || !!delayTimer;
+	
+					if ( autoHideMode ) {
+						$.mobile.fixedToolbars.clearShowTimer();
+	
+						if ( isOverlayState ) {
+								$.mobile.fixedToolbars.hide( true );
+						}
+					}	 		
 				}
 			})
-			.bind( "scrollstop", function( event ) {
 
+			.bind( "scrollstop", function( event ) {
 				if ( $( event.target ).closest( ignoreTargets ).length ) {
 					return;
 				}
@@ -145,40 +214,201 @@ $.mobile.fixedToolbars = (function() {
 				stateBefore = null;
 			});
 
-			$window.bind( "resize updatelayout", showEventCallback );
+			$window.bind( "resize", showEventCallback );
 	});
 
 	// 1. Before page is shown, check for duplicate footer
 	// 2. After page is shown, append footer to new page
-	$( ".ui-page" )
-		.live( "pagebeforeshow", function( event, ui ) {
+	$( ".ui-page" )  /* Fixed header modify for theme-s : Jinhyuk */
+		.live( "pagebeforeshow", function( event, ui ) {		
+			var s_theme_header = $( event.target ).find( ":jqmData(role='header')" );
+			var s_theme_fieldcontain = s_theme_header.find( ":jqmData(role='fieldcontain')" );
+			var s_theme_content = $( event.target ).find( ".ui-content" );
+			var title_style = "normal";
+			if( s_theme_fieldcontain.length != 0 ) 
+				title_style = "extended";
+			
+			if( s_theme_header.jqmData("position") == "fixed" || s_theme_header.css("position") == "fixed" ){
+				s_theme_header
+					.css( "position", "fixed" )
+					.css( "top", "0px" );
+				if( s_theme_header.children().is(".ui-navbar") ) {
+					s_theme_header.addClass( "ui-title-controlbar-height" );
+					$( event.target ).find( ".ui-content" ).addClass( "ui-title-content-controlbar-height" );
+				} else
+					$( event.target ).find( ".ui-content" ).addClass( "ui-title-content-" + title_style + "-height" );
+			}
+
+			if( s_theme_header.children().is(".ui-option-header") ){
+				s_theme_content.removeClass( "ui-title-content-" + title_style + "-height" );
+				if( s_theme_header.children().is(".input-search-bar") ){
+					s_theme_content.addClass( "ui-title-content-optionheader-search" );
+				} else{
+					if( $.tizen.optionheader.prototype.options.collapseOnInit == true )
+						s_theme_content.addClass( "ui-title-content-option-header-collapsed-1line-height" );
+					else
+						s_theme_content.addClass( "ui-title-content-option-header-expanded-1line-height" );
+				}
+			} else if( s_theme_header.find("input").jqmData("type") == "search" ){ /* In case searchbar in header : Jinhyuk */
+				s_theme_content
+					.removeClass( "ui-title-content-" + title_style + "-height" )
+					.addClass( "ui-title-content-search" );
+				}
+
+				if(s_theme_header.children().is("a") || s_theme_header.children().find(".ui-radio").length != 0){
+					if(title_style == "normal"){
+						if(s_theme_header.children("a").length == 1 || s_theme_header.children("a").length == 2){}
+					else if( s_theme_header.children("a").length == 3 ){
+						s_theme_header.find( "a" ).eq( 1 )
+							.removeClass( "ui-btn-right" )
+							.addClass( "ui-title-normal-3btn" );
+						s_theme_header.find( "a" ).eq( 2 )
+							.addClass( "ui-btn-right" );
+					} else {/* Need to implement new layout */}
+				} else{
+					var group_length = s_theme_fieldcontain.find( ".ui-radio" ).length;
+
+					s_theme_header.addClass( "ui-title-extended-height" );
+					s_theme_fieldcontain.find( ".ui-controlgroup" ).addClass( "ui-title-extended-controlgroup" );
+					s_theme_fieldcontain.find( ".ui-controlgroup" ).addClass( "ui-extended-controlgroup" );
+					s_theme_fieldcontain.addClass( "ui-title-extended-segment-style" );
+
+					if( group_length == 2 || group_length == 3 || group_length == 4 )
+						s_theme_fieldcontain.addClass( "ui-title-extended-controlgroup-" + group_length + "btn" );
+					else { /* Need to implement new layout */}
+				}
+				s_theme_content.addClass( "ui-title-content-" + title_style + "-height" );
+			}
+
+			/* resize footer : Jinhyuk    */
+			var footer_filter = $(document).find(":jqmData(role='footer')");
+			if( footer_filter.find(".ui-navbar").is(".ui-controlbar-s") ){
+				footer_filter
+					.css( "top", window.innerHeight  - footer_filter.height() )
+					.show();
+			}		
+			/* resize footer : Jinhyuk    */
+			if( footer_filter.children().find(".ui-radio").length != 0 ){
+				var footerGroup = footer_filter.find( ":jqmData(role='fieldcontain')" );
+				var groupLength = footerGroup.find( ".ui-radio" ).length;
+				footerGroup.find( ".ui-controlgroup" )
+					.addClass( "ui-extended-controlgroup" )
+					.addClass( "ui-footer-extended-controlgroup" )
+					.css( "display", "inline" );
+					/* Groupcontrol cannot initialize inline property at first page */
+				footerGroup.addClass( "ui-title-extended-controlgroup-" + groupLength + "btn" );				
+
+				footerButton = footer_filter.children( "a" );
+				footerButton.each(function(i){
+					if( footerButton.eq(i).is(".ui-btn") && !footerButton.eq(i).is(".ui-btn-back") ){
+						footerButton.eq( i )
+							.removeClass( "ui-btn-left" )
+							.addClass( "ui-btn-footer-right" );
+					}
+				});
+			}
 
 			var page = $( event.target ),
-				footer = page.find( ":jqmData(role='footer')" ),
-				id = footer.data( "id" ),
-				prevPage = ui.prevPage,
-				prevFooter = prevPage && prevPage.find( ":jqmData(role='footer')" ),
-				prevFooterMatches = prevFooter.length && prevFooter.jqmData( "id" ) === id;
+			footer = page.find( ":jqmData(role='footer')" ),
+			id = footer.data( "id" ),
+			prevPage = ui.prevPage,
+			prevFooter = prevPage && prevPage.find( ":jqmData(role='footer')" ),
+			prevFooterMatches = prevFooter.length && prevFooter.jqmData( "id" ) === id;
 
 			if ( id && prevFooterMatches ) {
 				stickyFooter = footer;
-				setTop( stickyFooter.removeClass( "fade in out" ).appendTo( $.mobile.pageContainer ) );
+				stickyFooter.removeClass( "fade in out" ).appendTo( $.mobile.pageContainer );
+				stickyFooter
+					.css("position", "fixed")
+					.css("top", $(".ui-page").find(":jqmData(role='footer')").eq(0).css("top"));
+
+			}									
+			if( footer.is(".ui-footer-fixed") ){
+				footer.css( "top", window.innerHeight - footer.height() );
+			}
+
+			/* Increase Content size with dummy <div> because of footer height */
+			if( footer.length != 0 && $( event.target ).find(".dummy-div").length == 0 ){
+				$( event.target ).find( ":jqmData(role='content')" ).append( '<div class="dummy-div"></div>' );
+				$( ".dummy-div" )
+					.css( "width", footer.width() )
+					.css( "height", footer.height() );		
+				if( $(".dummy-div").height() < defaultFooterHeight )
+					$( ".dummy-div" ).css( "height", defaultFooterHeight );
 			}
+
+			/* Header position fix(remove transition) : Jinhyuk */
+			var next_id = $( event.target ).attr( "id" );
+			$( "#"+next_id ).find( ":jqmData(role='header')" ).removeClass( "fade in out" ).appendTo( $.mobile.pageContainer );
 		})
+
 		.live( "pageshow", function( event, ui ) {
+			/* Fixed header modify for theme-s : Jinhyuk */
+			var s_theme_header = $( event.target ).find( ":jqmData(role='header')" );
+			if( s_theme_header.is(".ui-header-fixed") && s_theme_header.is(".ui-bar-s") ){	
+				$( event.target ).find( ":jqmData(role='header')" )
+					.css( "position", "fixed" )
+				.css("top", "0px");
+				 (( $( document ).scrollTop() === 0 ) ? $( window ) : $( document ) )
+					.unbind( "scrollstart")
+					.unbind( "silentscroll")
+					.unbind( "scrollstop");
+			}
 
 			var $this = $( this );
 
 			if ( stickyFooter && stickyFooter.length ) {
-
 				setTimeout(function() {
 					setTop( stickyFooter.appendTo( $this ).addClass( "fade" ) );
 					stickyFooter = null;
 				}, 500);
 			}
 
-			$.mobile.fixedToolbars.show( true, this );
+			$.mobile.fixedToolbars.show( true, this );					
+
+			/* Header position fix(remove transition) : Jinhyuk */
+			$("body").children(":jqmData(role='header')").insertBefore($(event.target).find(":jqmData(role='content')").eq(0));
+		})
+
+		.live( "vclick", function( event, ui ) {
+/*
+			var previous_index = $(".ui-page-active").find(":jqmData(role='footer')" ).find(".ui-state-persist").parents("li").index();
+			var active_index = $(event.target).parents("li").index();
+			var navbar_filter = $(".ui-page-active").find(":jqmData(role='footer')" ).find(":jqmData(role='navbar')");
+			var element_count = navbar_filter.find('li').length;
+			var style = navbar_filter.jqmData( "style" );
+			var list_width = $(".ui-page-active").find('.ui-navbar').width()/element_count;
+			
+			var next_link = $(event.target).parents("a").attr("href");
+			
+			
+			$(".ui-page-active").addClass("ui-btn-hide-style");
+
+
+			if(navbar_filter.find(".ui-btn-animation").length == 0 && style != "toolbar"){					
+				$('<div class="ani-focus"></div>').appendTo(navbar_filter.children());
+				$(".ani-focus")
+					.addClass("ui-btn-animation")	
+					.removeClass("ui-btn-ani-verticalendposition")
+					.removeClass("ui-btn-ani-endposition");
+
+			}					
+				$(".ani-focus")				
+					.css("width", navbar_filter.width()/element_count )
+					.css("height",navbar_filter.css("height"))	
+					.css("left", previous_index * list_width);
+
+
+				$(".ui-btn-ani-startposition").css("-webkit-transform","translateX("+previous_index *list_width+")");
+				$(".ani-focus").addClass("ui-btn-ani-startposition");
+				
+				var t=setTimeout("",10);
+				$(".ui-btn-ani-endposition").css("-webkit-transform","translateX("+active_index *list_width+")");
+				$(".ani-focus").removeClass("ui-btn-ani-startposition");
+				$(".ani-focus").addClass("ui-btn-ani-endposition");
+*/
 		});
+		
 
 	// When a collapsiable is hidden or shown we need to trigger the fixed toolbar to reposition itself (#1635)
 	$( ".ui-collapsible-contain" ).live( "collapse expand", showEventCallback );
@@ -215,30 +445,34 @@ $.mobile.fixedToolbars = (function() {
 	}
 
 	function setTop( el ) {
-		var fromTop = $(window).scrollTop(),
-			thisTop = getOffsetTop( el[ 0 ] ), // el.offset().top returns the wrong value on iPad iOS 3.2.1, call our workaround instead.
-			thisCSStop = el.css( "top" ) == "auto" ? 0 : parseFloat(el.css( "top" )),
-			screenHeight = window.innerHeight,
-			thisHeight = el.outerHeight(),
-			useRelative = el.parents( ".ui-page:not(.ui-page-fullscreen)" ).length,
-			relval;
-
-		if ( el.is( ".ui-header-fixed" ) ) {
-
-			relval = fromTop - thisTop + thisCSStop;
-
-			if ( relval < thisTop ) {
-				relval = 0;
+		if(!(el.parents(".ui-page").find( ":jqmData(role='header')" ).is(".ui-header-fixed")&&
+		el.parents(".ui-page").find( ":jqmData(role='header')" ).is(".ui-bar-s"))){				
+			var fromTop = $(window).scrollTop(),
+				thisTop = getOffsetTop( el[ 0 ] ), // el.offset().top returns the wrong value on iPad iOS 3.2.1, call our workaround instead.
+				thisCSStop = el.css( "top" ) == "auto" ? 0 : parseFloat(el.css( "top" )),
+				screenHeight = window.innerHeight,
+				thisHeight = el.outerHeight(),
+				useRelative = el.parents( ".ui-page:not(.ui-page-fullscreen)" ).length,
+				relval;
+	
+			if ( el.is( ".ui-header-fixed" ) ) {
+	
+				relval = fromTop - thisTop + thisCSStop;
+	
+				if ( relval < thisTop ) {
+					relval = 0;
+				}
+	
+				return el.css( "top", useRelative ? relval : fromTop );
+			} else {
+				// relval = -1 * (thisTop - (fromTop + screenHeight) + thisCSStop + thisHeight);
+				// if ( relval > thisTop ) { relval = 0; }
+				relval = fromTop + screenHeight - thisHeight - (thisTop - thisCSStop );
+	
+				return el.css( "top", useRelative ? relval : fromTop + screenHeight - thisHeight );
 			}
-
-			return el.css( "top", useRelative ? relval : fromTop );
-		} else {
-			// relval = -1 * (thisTop - (fromTop + screenHeight) + thisCSStop + thisHeight);
-			// if ( relval > thisTop ) { relval = 0; }
-			relval = fromTop + screenHeight - thisHeight - (thisTop - thisCSStop );
-
-			return el.css( "top", useRelative ? relval : fromTop + screenHeight - thisHeight );
 		}
+
 	}
 
 	// Exposed methods
@@ -264,16 +498,16 @@ $.mobile.fixedToolbars = (function() {
 					thisHeight = el.outerHeight(),
 					alreadyVisible = ( el.is( ".ui-header-fixed" ) && fromTop <= thisTop + thisHeight ) ||
 														( el.is( ".ui-footer-fixed" ) && thisTop <= fromTop + screenHeight );
-
+// block blink code in title : Jinhyuk
 				// Add state class
-				el.addClass( "ui-fixed-overlay" ).removeClass( "ui-fixed-inline" );
+//				el.addClass( "ui-fixed-overlay" ).removeClass( "ui-fixed-inline" );
 
-				if ( !alreadyVisible && !immediately ) {
+/*				if ( !alreadyVisible && !immediately ) {
 					el.animationComplete(function() {
 						el.removeClass( "in" );
 					}).addClass( "in" );
-				}
-				setTop(el);
+				}*/
+//				setTop(el);
 			});
 		},
 
-- 
1.7.5.4

