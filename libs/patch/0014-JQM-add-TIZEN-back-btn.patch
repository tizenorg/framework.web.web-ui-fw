From 9194807cb435b256bf5f4d45f585e1ed0bbab303 Mon Sep 17 00:00:00 2001
From: Jinhyuk Jun <jinhyuk.jun@samsung.com>
Date: Wed, 12 Dec 2012 18:34:46 +0900
Subject: [PATCH] JQM: add TIZEN back btn

Signed-off-by: Jun Jinhyuk <jinhyuk.jun@samsung.com>
---
 libs/js/jquery-mobile-1.2.0/js/widgets/page.js     |   13 +++++
 .../js/widgets/page.sections.js                    |   19 ++++++--
 2 files changed, 27 insertions(+), 56 deletions(-)
 delete mode 100644 libs/patch/0014-JQM-add-back-btn-option-and-remove-jqm-back-btn.patch

diff --git a/libs/js/jquery-mobile-1.2.0/js/widgets/page.js b/libs/js/jquery-mobile-1.2.0/js/widgets/page.js
index 256fbb2..d80bd26 100644
--- a/libs/js/jquery-mobile-1.2.0/js/widgets/page.js
+++ b/libs/js/jquery-mobile-1.2.0/js/widgets/page.js
@@ -55,6 +55,19 @@ $.widget( "mobile.page", $.mobile.widget, {
 		}
 	},
 
+	addBackBtn : function ( target ) {
+		var $dest = $( ".ui-page-active .ui-footer" );
+
+		if ( target == "header" ) {
+			$dest = $( ".ui-page-active .ui-header" );
+		}
+		backBtn = $( "<a href='#' class='ui-btn-back' data-" + $.mobile.ns + "rel='back'></a>" )
+			.buttonMarkup( {icon: "header-back-btn", theme : "s"} );
+		if ( !$dest.find( ".ui-btn-back").length ) {
+			backBtn.prependTo( $dest );
+		}
+	},
+
 	keepNativeSelector: function() {
 		var options = this.options,
 			keepNativeDefined = options.keepNative && $.trim( options.keepNative );
diff --git a/libs/js/jquery-mobile-1.2.0/js/widgets/page.sections.js b/libs/js/jquery-mobile-1.2.0/js/widgets/page.sections.js
index 7c05ecb..90a298a 100644
--- a/libs/js/jquery-mobile-1.2.0/js/widgets/page.sections.js
+++ b/libs/js/jquery-mobile-1.2.0/js/widgets/page.sections.js
@@ -35,6 +35,7 @@ $( document ).bind( "pagecreate", function( e ) {
 			$headeranchors,
 			leftbtn,
 			rightbtn,
+			$dest = $page.find( ".ui-footer" ),
 			backBtn;
 
 		$this.addClass( "ui-" + role );
@@ -63,15 +64,23 @@ $( document ).bind( "pagecreate", function( e ) {
 
 			// Auto-add back btn on pages beyond first view
 			if ( o.addBackBtn &&
-				role === "header" &&
-				$( ".ui-page" ).length > 1 &&
+				( role === "footer" || role === "header" ) &&
 				$page.jqmData( "url" ) !== $.mobile.path.stripHash( location.hash ) &&
 				!leftbtn ) {
 
-				backBtn = $( "<a href='javascript:void(0);' class='ui-btn-left' data-"+ $.mobile.ns +"rel='back' data-"+ $.mobile.ns +"icon='arrow-l'>"+ o.backBtnText +"</a>" )
+				if ( o.addBackBtn == "header" ) {
+					$dest = $page.find( ".ui-header" );
+				} else {
+					$dest = $page.find( ".ui-footer" );
+				}
+
+				backBtn = $( "<a href='javascript:void(0);' class='ui-btn-back' data-"+ $.mobile.ns +"rel='back' data-"+ $.mobile.ns +"icon='header-back-btn'></a>" )
 					// If theme is provided, override default inheritance
-					.attr( "data-"+ $.mobile.ns +"theme", o.backBtnTheme || thisTheme )
-					.prependTo( $this );
+					.attr( "data-"+ $.mobile.ns +"theme", o.backBtnTheme || thisTheme );
+
+				if ( !$dest.find( ".ui-btn-back" ).length ) {
+					backBtn.prependTo( $dest );
+				}
 			}
 
 			// Page title
-1.7.4.1
-
-- 
1.7.9.5

