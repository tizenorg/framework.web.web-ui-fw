<!DOCTYPE html>
<html>
	<head>
		<title>Engine tests</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../../../../libs/qunit-1.11.0.css">
		<script src="../../../../libs/jquery.js"></script>
		<script src="../../../../libs/qunit-1.11.0.js" type="text/javascript"></script>
		<script src="../../../../libs/support.js"></script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture">
			<div data-role="page" id="page1">
                <div id="test1-test-widget" class="test-widget-by-definition test"></div>
                <div class="test-widget-built" id="test3" data-tau-built="true" data-tau-selector="div.test-widget-built" data-tau-name="Test3"></div>
                <div id="test2-test-widget"></div>

                <div id="test3-test-widget" class="test-widget-by-definition test">
                    <div class="test-widget-by-definition test">A</div>
                </div>

                <div id="non-widget">
                    <span>text</span>
                </div>

                <div id="future-widget">
                    <span>future widget</span>
                </div>
            </div>
		</div>

		<script type="text/javascript">
			module("core/engine");
			asyncTest("generating widgets", function () {
				expect(6);
				document.addEventListener("bound", function test1() {
					// @NOTE: ACTUAL TESTS HERE!
					document.removeEventListener("bound", test1);
					var engine = ej.engine,
						eventUtils = ej.event,
						el1 = document.getElementById("test1-test-widget"),
						el3 = document.body.querySelector(".test-widget-built"),
						b1 = engine.getBinding(el1),
						e1 = b1.element;

					ok(b1, "binding for widget1 with def created");

					equal(b1.id, el1.id, "DOM and binding ids are the same for widget1");

					ok(e1.children.length, "widget1 child created");

					ok(e1.classList.contains("test"), "Widget1 classes moved");

					equal(b1.apiCall(2), 4, "Widget1 api call");

					e1.addEventListener("test-event-bounce", function (evt1) {
						var data = evt1.detail.testData;
						equal(data, 4, "Widget1 event returning data");
						start();
					}, false);

					eventUtils.trigger(e1, "test-event", {"testData": 2});
				});
				ej.engine.run();
			});

			asyncTest("Body and html classes", function () {
				document.body.addEventListener("pageinit", function pagechanged () {
					document.body.removeEventListener("pageinit", pagechanged);
					ok(document.documentElement.classList.contains('ui-mobile'), 'HTML has proper class');
					ok(document.body.classList.contains('ui-mobile-viewport'), 'BODY has proper class');
					start();
				});
				ej.engine.run(); //just make sure that engine was run
			});
		</script>
		<script type="text/javascript">
			var tauConfig = {
				"autorun": false
			};
		</script>
		<script src="../../../../libs/dist/js/tau.js" type="text/javascript"></script>
		<script src="../tau.test.widget1.js"></script>
		<script src="../tau.test.widget2.js"></script>
		<script type="text/javascript" src="../engine-methods.js"></script>
	</body>
</html>

